language: ruby
rvm: 2.5.1
services: postgresql
cache: bundler
before_install:
- sudo /etc/init.d/postgresql stop
- sudo apt-get update
- sudo apt-get purge postgresql-9.1 postgresql-9.2 postgresql-9.3
- sudo apt-get install postgresql-9.4
- sudo chmod 777 /etc/postgresql/9.4/main/pg_hba.conf
- sudo echo "local   all         postgres                          trust" >  /etc/postgresql/9.4/main/pg_hba.conf
- sudo echo "local   all         all                               trust" >> /etc/postgresql/9.4/main/pg_hba.conf
- sudo echo "host    all         all         127.0.0.1/32          trust" >> /etc/postgresql/9.4/main/pg_hba.conf
- sudo echo "host    all         all         ::1/128               trust" >> /etc/postgresql/9.4/main/pg_hba.conf
- sudo /etc/init.d/postgresql restart
- psql --version
before_script:
- cp config/database.travis.yml config/database.yml
- bundle exec rake db:create
- bundle exec rake db:migrate
script: bundle exec rspec spec/
notifications:
  slack:
    secure: dCN7Bhp5z6EaVoebyWrqSgZS+C1kPjG4a71dk59NqKqkAtCQxMplg9asm9VBuEZVuaNVtXb4AmIPMpxRiHIL67/PR0yqJqBEvf85KZrX7Ld7Z6oVWHfq6At36CE9GU01LT8OILS26v7SitAjFgF4b11rCEeakYcVbIIqwtq8gcTJoGOS3mt8bW9YOYKKcjQ78O1611dI2lhlNJEcxzSkyTUy+R+lCdzkWHGa3FU2Mc+uVlJcOvnFWS4O0m+0LbJ7n6WwXkdNazYqx4o34+rMgwdVZYBFXvP3Ja/X34MW+w8Ry5BSnnCE2t8kcdU5ko5n3M9Ov/IwFmqIEJ6SGWJ19vqgBlzgVDB+M2IgL4g/Jx0ELypL9yQMcShc1o4rqyaDkiIKDGChKdWDSEn6Si38euaRf34RKaLEfO8SllFOOD6KrjQ/RLryeTmzD5QXr3sffANYKTqJKLNVUM4LzBR79dKsUV4LHk6f0tqKW+egajwrL7j/FCRiW++pK+C24xganNU5E1I4uwRVF7FKdyPtEdaQWDbftp/x3WuZXuNyzbKUjZC9m9J07QLStDYjF0JUD2RE5OVCKmp2m1M+j+L2NJExWNQt4Q+Jy3WHtw5KRuwCtJ/3SMYyj20Fn4Y8Uf7CMmXXuksuIX/K8z1cQFKOaz2jgQoxtqS5g2wFPOVIUHQ=
deploy:
  provider: heroku
  api_key:
    secure: crlaPKPpUEkVfPbxagiSu1HbdUbEP1nbIH54RootAQ8pDzFSbpCvGORTYUkWA7zYxKMP0+iI8NofeJxnz3bP16hg7DlRK5PqIF+x5j1DjvMU+C3K9KXH5VQsGk+CaN4VATMrtuQaqNbxtYgtsUaGrNekhKrNQ2CeKKGu6oh+Ex3qPORI0BxgCt2VdRqYgUfL/tsCNbFU07xoFYs8Sla4ZfGb/2mOYgFo9ugmLAOjZ7GmZALxNqIVDywHj/rtkrDZOtrJKfk37sFOA95cg+nVADzbcZt4yu4YJ6BYvSwLrQWrrg7hn40AtcDADTJfAWBYaw7taH+5hw7C5fzoeAh7wCS5hEZuD82e71ObG7Lu74zlnZkfYKwKdXe4HAHPQjVrsgg3YBcJbHvunkN3DY5il0OPSDlc4M50PJkP5MQlQg1++cKnE/PkvERC984ffH1YVDIsZ7Kj3YCc/YGMC4qlFihtv14uom7/pFQIw4sCVnsk+8LTy8jj8999UbWrhMx5Rt9s56R6FPVNgD/O5wiReuseijrM2zn+qdCEQiK3EGRMPIEfc/Ir6OeRI9eQ3Cq5oTgWWVV/uOsrN9tK7gBHu170uFC/L/pqYlKki3+e7HIUVwttGGrbrCLgfMUhqqc2cd6dwG9MjY8rGroGMyR3fn67cMSyVkq31PfE3GlbDt4=
  app:
    master: food_search
    production: food-line
  on:
    tags: false
    branch: master
    run: rake db:migrate
